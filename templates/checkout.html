<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>

    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=USD&intent=capture"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            min-height: 100vh;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu;
            background: linear-gradient(135deg, #eef2ff, #f8fafc);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checkout-container {
            width: 100%;
            max-width: 420px;
            background: #ffffff;
            border-radius: 14px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            padding: 24px;
        }

        .checkout-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .checkout-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
            color: #111827;
        }

        .checkout-header p {
            margin-top: 6px;
            font-size: 14px;
            color: #6b7280;
        }

        .order-summary {
            background: #f9fafb;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .order-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            color: #374151;
        }

        .order-row.total {
            font-weight: 700;
            font-size: 16px;
            border-top: 1px solid #e5e7eb;
            padding-top: 10px;
            margin-bottom: 0;
        }

        #paypal-button-container {
            margin-top: 12px;
        }

        .secure-text {
            text-align: center;
            font-size: 12px;
            color: #6b7280;
            margin-top: 16px;
        }

        @media (max-width: 480px) {
            .checkout-container {
                margin: 16px;
                padding: 20px;
            }
        }
    </style>
</head>

<body>

<div class="checkout-container">

    <div class="checkout-header">
        <h2>Order Summary</h2>
        <p>Complete your payment safely with PayPal</p>
    </div>

    <div class="order-summary">
        <div class="order-row">
            <span>Plan</span>
            <span>{{option.title}}</span>
        </div>
        <div class="order-row">
            <span>Billing</span>
            <span>Yearly</span>
        </div>
        <div class="order-row total">
            <span>Total</span>
            <span>${{option.price}}</span>
        </div>
    </div>

    <div id="paypal-button-container"></div>

    <div class="secure-text">
        ðŸ”’ Secure payment powered by PayPal
    </div>
</div>

<script>
const ORDER_AMOUNT = "{{ option.price|floatformat:2 }}";
paypal.Buttons({
    createOrder: function (data, actions) {
        return actions.order.create({
            purchase_units: [{
                amount: {
                    value: ORDER_AMOUNT
                }
            }]
        });
    },

    onApprove: function (data, actions) {
        return actions.order.capture().then(function (details) {
            fetch("{% url 'main:payment_success' option.pk %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify(details)
            }).then(() => {
                window.location.href = "{% url 'main:payment_success' option.pk %}";
            });
        });
    },

    onCancel: function () {
        window.location.href = "{% url 'main:payment_failed' option.pk %}";
    },

    onError: function (err) {
        console.error("PayPal error:", err);
        alert("Payment error â€“ please try again.");
    }
}).render("#paypal-button-container");
</script>

</body>
</html>
